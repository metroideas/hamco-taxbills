{"version":3,"sources":["chart.js"],"names":["window","document","d3","data","draw","hover","bar","on","d","tooltip","select","classed","dollar","format","html","year","appraisal","median","county","municipality","matrix","this","getCTM","translate","getAttribute","style","adjust","w","slice","left","event","pageX","e","width","h","top","pageY","f","height","container","querySelector","chart","mobile","offsetWidth","location","type","ratio","margin","right","bottom","Math","round","console","log","taxbills","length","placeholders","map","bills","filter","p","find","b","concat","sort","a","max","compare","start","m","i","yearScale","scaleBand","domain","appraisalScale","scaleLinear","range","padding","axis","axisTop","tickSize","axisLeft","tickArguments","innerHTML","svg","append","attr","call","remove","bars","selectAll","enter","labels","text","bandwidth","checked","id","line","x","y","datum","offset","onload","onresize"],"mappings":"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","file":"chart.min.js","sourcesContent":["(function(window, document, d3, data) {\n  if (d3) {\n    window.onload = draw;\n    window.onresize = draw;  \n  }\n  \n  function draw() {\n    var\n    container = document.querySelector(\"#graphic\"), // Visualization parent\n    chart     = container.querySelector(\".chart\"),  // SVG parent\n    mobile    = (+container.offsetWidth <= 768), // Container size boolean flips chart orientation\n    location  = (data.type == null), // Data type boolean indicates that data is a Location result\n    ratio     = (mobile) ? { width: 1, height: 2 } : { width: 8, height: 3 },\n    margin    = {\n      top: 32,\n      right: 16,\n      bottom: 32,\n      left: (mobile) ? 32 : 40,\n      width: function() { return this.right + this.left; },\n      height: function() { return this.top + this.bottom; }\n    },\n    width     = +container.offsetWidth - margin.width(), // Chart width\n    height    = Math.round(width * (ratio.height / ratio.width) - margin.height()) // Chart height\n    ;\n\n    console.log(data)\n\n    /*\n      Some Location API results will have fewer years of tax data than expected. \n      Placeholder data is added for those instances to ensure consistent comparisons and layout\n    */\n    if (location && data.taxbills.length != data.county.taxbills.length) {\n      var placeholders = data.county.taxbills.map(function(d) { return { year: d.year }; })\n      var bills = data.taxbills;\n      \n      placeholders = placeholders.filter(function(p) {\n        return !bills.find(function(b) {\n          return b.year == p.year;\n        })\n      })\n\n      data.taxbills = bills.concat(placeholders).sort(function(a,b) {\n        return a.year - b.year;\n      })\n\n      placeholders = bills = null;\n    }\n\n    /*\n      Locations with low property values may result in graphics that push summary lines (e.g. countywide)\n      out of the SVG's range. This function queries each summary taxbills array and returns the highest value\n      for the linear (dollar amount) scale\n    */\n    // Check summary taxbills for highest appraisal value\n    var max = function() {\n      function compare(data, start) {\n        var m = d3.max(data, function(d) { return d.appraisal.median; });\n        return (start > m) ? start : m;\n      }\n      // Initial\n      var m = compare(data.taxbills, 0);\n\n      for (var i in data) {\n        if (data[i].taxbills) {\n          m = compare(data[i].taxbills, m);\n        }\n      }\n      \n      return m;\n    }();\n\n    /*\n      Orientation-based scales and axes\n      Default values are initially set, followed by conditional x/y settings determined by the mobile boolean\n    */\n    \n    var yearScale = d3.scaleBand()\n        .domain(data.taxbills.map(function(d) { return d.year; }));\n\n    var appraisalScale = d3.scaleLinear()\n        .domain([0, max]);\n\n    if (mobile) {\n      yearScale.range([0, height])\n        .padding(0.1);\n\n      appraisalScale.range([0, width]);\n\n      var axis = d3.axisTop(appraisalScale)\n        .tickSize(-height, 0, 0);\n\n    } else {\n      yearScale.range([0, width])\n        .padding(0.25);\n\n      appraisalScale.range([height, 0])\n\n      var axis = d3.axisLeft(appraisalScale)\n        .tickSize(-width, 0, 0);\n    }\n\n    axis.tickArguments([4, d3.format(\"$.0s\")]);\n    \n    /*\n      Initial chart setup\n      \n      Inner HTML is cleared each time draw() is called. This will remove any placeholder images on page load\n      and add \"responsive\" behavior on resize\n\n      The svg variable is the parent of all SVG elements, and is made \"responsive\" by dynamic width/height variables above\n\n      To Do: Needs title and description copy\n    */\n    chart.innerHTML = \"\";\n\n    var svg = d3.select(chart).append(\"svg\")\n        .attr(\"width\", width + margin.width())\n        .attr(\"height\", height + margin.height())\n      .append(\"g\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    // Draw axis and remove first axis label for zero\n    svg.append(\"g\")\n      .attr(\"class\", \"axis\")\n      .call(axis);\n\n    svg.select(\"g.axis g.tick:first-of-type text\").remove();\n\n    /*\n      Bar groups are binded to the primary taxbills array and contain both rect and text (label) elements\n\n      Other than the placement transform, the initial values are defaults, followed by vertical/horizontal\n      orientation specific values\n\n      Only the horizontal orientation includes the mouseover tooltip\n    */\n    var bars = svg.append(\"g\").attr(\"class\", \"bars\")\n      .selectAll(\"g.bar-group\")\n        .data(data.taxbills)\n      .enter().append(\"g\")\n        .attr(\"class\", \"bar-group\");\n\n    // Placement transform: Has to occur before label append\n    bars.attr(\"transform\", function(d) {\n      return (mobile)\n        ? \"translate(0,\" + yearScale(d.year) + \")\"  // Vertical - \"mobile\"\n        : \"translate(\" + yearScale(d.year) + \",0)\"; // Horizontal\n    });\n\n    var labels = bars.append(\"text\")\n      .attr(\"class\", \"label\")\n      .text(function(d) { return d.year; });\n\n    // Bar groups: Orientation-based labels and rects\n    if (mobile) {\n      // Vertical orientation\n      labels.attr(\"transform\",\n        \"translate(\" + -margin.left + \",\" + yearScale.bandwidth() / 2 + \")\")\n        .attr(\"dominant-baseline\", \"middle\");\n\n      bars.append(\"rect\")\n        .attr(\"x\", 0)\n        .attr(\"y\", 0)\n        .attr(\"height\", yearScale.bandwidth())\n        .attr(\"width\", function(d) { return appraisalScale(d.appraisal.median); })\n\n    } else {\n      // Horizontal orientation\n      labels.attr(\"transform\", function(d) {\n        return \"translate(\" + yearScale.bandwidth() / 2 + \",\" + (height + margin.bottom / 2) + \")\"; })\n        .attr(\"text-anchor\", \"middle\");\n\n      bars.append(\"rect\")\n        .attr(\"x\", 0)\n        .attr(\"y\", function(d) { return appraisalScale(d.appraisal.median); })\n        .attr(\"height\", function(d) { return height - appraisalScale(d.appraisal.median); })\n        .attr(\"width\", yearScale.bandwidth())\n        .call(hover); // Mouseover tooltip on horizontal orientation only\n    }\n\n    /*\n      Shows or hides a tooltip based on mouseover and mouseout events\n      The tooltip has dynamic text values for year, appraisal, county and municipality\n    */\n    function hover(bar) {\n      bar\n        .on(\"mouseover\", function(d) {\n          // Change rect properties\n          // d3.select(this).attr(/* ... */)\n\n          var tooltip = d3.select(\"#tooltip\").classed(\"hidden\", false);\n          var dollar = d3.format(\"$,\");\n          \n          tooltip.select(\"#year\").html(d.year);\n          tooltip.select(\"#appraisal-amount\").html(dollar(d.appraisal.median));\n          tooltip.select(\"#county-amount\").html(dollar(d.county.median));\n          tooltip.select(\"#municipality-amount\").html(dollar(d.municipality.median));\n\n          var matrix = this.getCTM()\n              .translate(+ this.getAttribute(\"cx\"), + this.getAttribute(\"cy\"));\n\n          tooltip.style(\"left\", function() {\n            var\n            w      = +tooltip.style(\"width\").slice(0, -2),\n            left   = d3.event.pageX - w / 2,\n            adjust\n            ;\n\n            // Slide tooltips away from edges\n            if (matrix.e <= width * .25) {\n              adjust = (width - matrix.e) / width;\n              left += adjust * w / 2;\n            } else if (matrix.e >= width * .75) {\n              adjust = 1 - (width - matrix.e) / width;\n              left -= adjust * w / 2;\n            }\n\n            return left + \"px\";\n          });\n\n          tooltip.style(\"top\", function() {\n            var h   = +tooltip.style(\"height\").slice(0, -2);\n            var top = d3.event.pageY;\n            \n            top = (matrix.f >= height * .5) ? top - h * 1.5 : top + 15;\n            \n            return top + \"px\";\n          });\n        })\n        .on(\"mouseout\", function() {\n          d3.select(\"#tooltip\").classed(\"hidden\", true);\n        })\n    }\n\n    /*\n      Summary lines for location comparison\n      These are toggled by checkbox inputs in the DOM to add or remove lines for comparing a \n      property's annual taxbills to summary median values\n    */\n    if (location) {\n      d3.selectAll(\"input[type='checkbox']\").on(\"change\", function() {\n      \n        if (this.checked) {\n          var type = this.id;\n          // d3 line generator\n          var line = d3.line()\n            .x(function(d) { return (mobile) ? appraisalScale(d.appraisal.median) : yearScale(d.year); })\n            .y(function(d) { return (mobile) ? yearScale(d.year) : appraisalScale(d.appraisal.median); });\n\n\n          svg.append(\"path\").attr(\"class\", \"summary \" + type)\n            .datum(data[type].taxbills)\n            .attr(\"d\", line)\n            .attr(\"transform\", function(d) {\n              var offset = yearScale.bandwidth() / 2;\n              \n              return (mobile)\n                ? \"translate(0,\" + offset + \")\"\n                : \"translate(\" + offset + \",0)\";\n            });\n        } else {\n          var line = \"path.summary.\" + this.id;\n          d3.select(line).remove();\n        }\n      })\n    }\n\n    // End of draw()\n  }\n})(window, document, d3, data);\n"],"sourceRoot":"/source/"}