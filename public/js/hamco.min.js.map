{"version":3,"sources":["hamco.js"],"names":["map","window","draw","d3","json","err","topology","data","topojson","feature","objects","blockgroups","bounds","geoBounds","center","projection","selectAll","features","enter","append","attr","path","svg","call","zoom","transform","zoomIdentity","translate","width","height","scale","minZoom","zoomed","event","tiles","tile","k","x","y","style","image","mapTiles","stringify","d","exit","remove","mapbox","base","tileset","key","url","z","this","r","Number","Math","round","pi","PI","tau","container","document","querySelector","breakpoint","offsetWidth","maxZoom","innerHTML","onload","geoMercator","geoPath","size","scaleExtent","on","select","html","update"],"mappings":"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","file":"hamco.min.js","sourcesContent":["var map = window.map || {};\n\n(function(map) {\n  var\n  pi         = Math.PI,\n  tau        = pi * 2,\n  container  = document.querySelector(\"#map\"),\n  breakpoint = 800,\n  width      = +container.offsetWidth,\n  height     = Math.round(width * 1.1),\n  mobile     = width < breakpoint,\n  maxZoom    = (1 << 26),\n  minZoom    = (1 << 19) * (width / breakpoint)\n  ;\n\n  container.innerHTML = \"\";\n\n  window.onload = draw();\n\n  var projection = d3.geoMercator()\n    .scale(1 / tau)\n    .translate([0, 0]);\n\n  var path = d3.geoPath()\n    .projection(projection);\n\n  var tile = d3.tile()\n    .size([width, height]);\n\n  var zoom = d3.zoom()\n    .scaleExtent([minZoom, maxZoom])\n    .on(\"zoom\", zoomed);\n\n  var svg = d3.select(container).append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height)\n    ;\n\n  var mapTiles = svg.append(\"g\")\n    .attr(\"id\", \"map-tiles\");\n\n  var blockgroups = svg.append(\"g\")\n    .attr(\"id\", \"blockgroups\");\n\n  d3.select(\"#map\").append(\"div\")\n    .attr(\"class\", \"attribution\")\n    .html('<a href=\"http://metroideas.org\">Metro Ideas Project</a> | <a href=\"https://www.mapbox.com/about/maps/\" target=\"_blank\">Mapbox</a> | Â© <a href=\"http://www.openstreetmap.org/copyright\" target=\"_blank\">OpenStreetMap</a>')\n\n  map.update = function(data) {\n    // Delete old marker\n    // Pan and/or zoom map to coordinates\n    // Place new marker\n    // console.log(data.coordinates);\n  }\n\n  function draw() {\n    d3.json(\"/js/hamco.topo.json\", function(err, topology) {\n      if (err) throw err;\n\n      var data   = topojson.feature(topology, topology.objects.blockgroups);\n      var bounds = d3.geoBounds(data);\n      var center = projection([ ((bounds[0][0] + bounds[1][0]) / 2), ((bounds[0][1] + bounds[1][1]) / 2) ]);\n      \n      blockgroups.selectAll(\"path.blockgroup\")\n          .data(data.features)\n        .enter().append(\"path\")\n          .attr(\"class\", \"blockgroup\")\n          .attr(\"d\", path)\n          .attr(\"fill\", \"none\")\n          ;\n\n      svg\n        .call(zoom)\n        .call(zoom.transform, d3.zoomIdentity\n          .translate(width / 2, height / 2)\n          .scale(minZoom)\n          .translate(-center[0], -center[1])); \n    });\n  }\n\n  function zoomed() {\n    var transform = d3.event.transform;\n\n    var tiles = tile\n      .scale(transform.k)\n      .translate([transform.x, transform.y])\n      ();\n\n    blockgroups.selectAll(\"path.blockgroup\")\n      .attr(\"transform\", transform)\n      .style(\"stroke-width\", 1 / transform.k)\n      ;\n\n    var image = mapTiles\n        .attr(\"transform\", stringify(tiles.scale, tiles.translate))\n      .selectAll(\"image\")\n      .data(tiles, function(d) { return d; });\n\n    image.exit().remove();\n\n    image.enter().append(\"image\")\n      .attr(\"class\", \"tile\")\n      .attr(\"x\", function(d) { return d[0] * 256; })\n      .attr(\"y\", function(d) { return d[1] * 256; })\n      .attr(\"width\", 256)\n      .attr(\"height\", 256)\n      .attr(\"xlink:href\", function(d) {\n        var mapbox = {\n          base:    \"https://api.mapbox.com/styles/v1/mdavidmorton/\",\n          style:   \"ciu5nfp4500eg2ipgdjbmflkw/\",\n          tileset: \"tiles/256/\",\n          key:     \"@2x?access_token=pk.eyJ1IjoibWRhdmlkbW9ydG9uIiwiYSI6ImNpZzN5cDZyNTI3czJ1c201cjlvMjh4OWQifQ.CGZjS_17LA9FrdS92dMUow\",\n          url: function(x,y,z) { return this.base + this.style + this.tileset + z + \"/\" + x + \"/\" + y + this.key; }\n        }\n        var x = d[0], y = d[1], z = d[2];\n       \n        return mapbox.url(x,y,z);\n      });\n  }\n\n  function stringify(scale, translate) {\n    var\n    k = scale / 256,\n    r = scale % 1 ? Number : Math.round\n    ;\n\n    return \"translate(\" + r(translate[0] * scale) + \",\" + r(translate[1] * scale) + \") scale(\" + k + \")\";\n  }\n\n})(map)"],"sourceRoot":"/source/"}