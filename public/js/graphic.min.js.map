{"version":3,"sources":["graphic.js"],"names":["graphic","window","scale","axis","year","d3","scaleBand","domain","data","taxbills","map","d","appraisal","scaleLinear","max","mobile","range","height","padding","width","axisTop","tickSize","axisLeft","tickArguments","format","median","summaries","years","cont","select","classed","selectAll","remove","inputs","enter","append","attr","type","labels","html","checkbox","svg","name","on","this","checked","dataset","datum","filter","line","x","y","offset","bandwidth","bargroups","bars","text","margin","left","bottom","call","hover","bar","tooltip","dollar","county","municipality","matrix","getCTM","translate","getAttribute","style","adjust","w","slice","event","pageX","e","h","top","pageY","f","container","document","querySelector","chart","offsetWidth","ratio","right","Math","round","draw","scales","innerHTML","update","result","countyDistrict","zipcode","compare","start","m","i"],"mappings":"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","file":"graphic.min.js","sourcesContent":["var graphic = window.graphic || {};\n\n(function() {\n  // Dimensions\n  var\n  container = document.querySelector(\"#graphic\"),\n  chart     = container.querySelector(\".chart\"),\n  mobile    = (+container.offsetWidth <= 768),\n  ratio     = (mobile) ? { width: 1, height: 2 } : { width: 8, height: 3 },\n  margin    = {\n    top: 32,\n    right: 16,\n    bottom: 32,\n    left: (mobile) ? 32 : 40,\n    width: function() { return this.right + this.left; },\n    height: function() { return this.top + this.bottom; }\n  },\n  width     = +container.offsetWidth - margin.width(),\n  height    = Math.round(width * (ratio.height / ratio.width) - margin.height())\n  ;\n\n  // Undefined variables\n  var data;\n  var max;\n  var svg;\n\n  /*\n    Public methods:\n    graphic.draw()\n    graphic.update(result) \n    graphic.data(result)\n  */\n  graphic.draw = function() {\n    var scales    = scale();\n    var appraisal = scales.appraisal;\n    var years     = scales.year;\n    var axis      = scales.axis;\n    \n    // Update graphic title\n    if (data.name != \"Hamilton County\") {\n      document.querySelector(\"#barchart-title\").innerHTML = data.name;  \n    }\n\n    // Initial setup\n    chart.innerHTML = \"\";\n    \n    svg = d3.select(chart).append(\"svg\")\n        .attr(\"width\", width + margin.width())\n        .attr(\"height\", height + margin.height())\n      .append(\"g\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    // Draw axis and remove first axis label for zero\n    svg.append(\"g\")\n      .attr(\"class\", \"axis\")\n      .call(axis);\n\n    svg.select(\"g.axis g.tick:first-of-type text\").remove();\n\n    bargroups(appraisal, years);\n\n    if (data.summaries) {\n      summaries(appraisal, years);\n    }\n  }\n\n  graphic.update = function(result) {\n    graphic.data(result);\n    graphic.draw();\n  }\n\n  // Sets data variables\n  graphic.data = function(result) {\n    data = result;\n\n    // For location/non-summary data\n    if (data.type != 'county') {\n      data.summaries = function() {\n        return [ data.county, data.municipality, data.countyDistrict, data.zipcode ]\n      }();  \n    }\n    \n    // Sets max value in scales\n    max = function() {\n      function compare(data, start) {\n        var m = d3.max(data, function(d) { return median(d); });\n        return (start > m) ? start : m;\n      }\n      // Initial\n      var m = compare(data.taxbills, 0);\n\n      for (var i in data) {\n        if (data[i].taxbills) {\n          m = compare(data[i].taxbills, m);\n        }\n      }\n      \n      return m;\n    }();\n  }\n\n  function scale() {\n    var year = d3.scaleBand()\n      .domain(data.taxbills.map(function(d) { return d.year; }));\n\n    var appraisal = d3.scaleLinear()\n      .domain([0, max]);\n\n    var axis;\n\n    if (mobile) {\n      year.range([0, height])\n        .padding(0.1);\n\n      appraisal.range([0, width]);\n\n      axis = d3.axisTop(appraisal)\n        .tickSize(-height, 0, 0);\n    \n    } else {\n      year.range([0, width])\n        .padding(0.25);\n\n      appraisal.range([height, 0])\n\n      axis = d3.axisLeft(appraisal)\n        .tickSize(-width, 0, 0);\n    }\n\n    axis.tickArguments([4, d3.format(\"$.0s\")]);\n\n    return {\n      year:      year,\n      axis:      axis,\n      appraisal: appraisal\n    }\n  }\n\n  function median(d) {\n    return d.appraisal.median || 0;\n  }\n\n  function summaries(appraisal, years) {\n    var cont  = d3.select(\"#comparison-container\")\n      .classed(\"hidden\", false);\n\n    cont.selectAll(\"p\").remove();\n\n    var inputs = cont.selectAll(\"p\")\n        .data(data.summaries)\n      .enter().append(\"p\")\n        .attr(\"class\", function(d) { return d.type; });\n\n    var labels = inputs.append(\"label\");\n\n    labels.html(function(d) {\n      var checkbox = \"<input type='checkbox' data-select='\" +  d.type + \"'> \";\n      \n      // Summary legend\n      var svg = \"<svg width='24' height='18'>\" +\n        \"<line x1='2' x2='20' y1='12' y2='12' />\" + \n        \"</svg>\";\n      \n      return checkbox + svg + d.name;\n    });\n\n    d3.selectAll(\"input[type='checkbox']\").on(\"change\", function() {\n      if (this.checked) {\n          var type  = this.dataset.select;\n          var datum = data.summaries.filter(function(d) {\n            return d.type == type;\n          })[0];\n\n          // d3 line generator\n          var line = d3.line()\n            .x(function(d) { return (mobile) ? appraisal(median(d)) : years(d.year); })\n            .y(function(d) { return (mobile) ? years(d.year) : appraisal(median(d)); });\n\n          svg.append(\"path\").attr(\"class\", \"summary \" + type)\n            .datum(datum.taxbills)\n            .attr(\"d\", line)\n            .attr(\"transform\", function(d) {\n              var offset = years.bandwidth() / 2;\n              \n              return (mobile)\n                ? \"translate(0,\" + offset + \")\"\n                : \"translate(\" + offset + \",0)\";\n            });\n        } else {\n          var line = \"path.summary.\" + this.dataset.select;\n          d3.select(line).remove();\n        }\n    })\n  }\n\n  function bargroups(appraisal, years) {\n\n    var bars = svg.append(\"g\").attr(\"class\", \"bars\")\n      .selectAll(\"g.bar-group\")\n        .data(data.taxbills)\n      .enter().append(\"g\")\n        .attr(\"class\", \"bar-group\");\n\n    bars.attr(\"transform\", function(d) {\n      return (mobile)\n        ? \"translate(0,\" + years(d.year) + \")\"  // Vertical - \"mobile\"\n        : \"translate(\" + years(d.year) + \",0)\"; // Horizontal\n    });\n\n    var labels = bars.append(\"text\")\n      .attr(\"class\", \"label\")\n      .text(function(d) { return d.year; });\n\n    // Bar groups: Orientation-based labels and rects\n    if (mobile) {\n      // Vertical orientation\n      labels.attr(\"transform\",\n        \"translate(\" + -margin.left + \",\" + years.bandwidth() / 2 + \")\")\n        .attr(\"dominant-baseline\", \"middle\");\n\n      bars.append(\"rect\")\n        .attr(\"x\", 0)\n        .attr(\"y\", 0)\n        .attr(\"height\", years.bandwidth())\n        .attr(\"width\", function(d) { return appraisal(median(d)); })\n\n    } else {\n      // Horizontal orientation\n      labels.attr(\"transform\", function(d) {\n        return \"translate(\" + years.bandwidth() / 2 + \",\" + (height + margin.bottom / 2) + \")\"; })\n        .attr(\"text-anchor\", \"middle\");\n\n      bars.append(\"rect\")\n        .attr(\"x\", 0)\n        .attr(\"y\", function(d) { return appraisal(median(d)); })\n        .attr(\"height\", function(d) { return height - appraisal(median(d)); })\n        .attr(\"width\", years.bandwidth())\n        .call(hover) // Mouseover tooltip on horizontal orientation only\n        ;\n    }\n  }\n\n  function hover(bar) {\n    bar\n      .on(\"mouseover\", function(d) {\n        var tooltip = d3.select(\"#barchart-tooltip\").classed(\"hidden\", false);\n        var dollar = d3.format(\"$,\");\n        \n        tooltip.select(\"#year\").html(d.year);\n        tooltip.select(\"#appraisal-amount\").html(dollar(d.appraisal.median));\n        tooltip.select(\"#county-amount\").html(dollar(d.county.median));\n        tooltip.select(\"#municipality-amount\").html(dollar(d.municipality.median));\n\n        var matrix = this.getCTM()\n            .translate(+ this.getAttribute(\"cx\"), + this.getAttribute(\"cy\"));\n\n        tooltip.style(\"left\", function() {\n          var\n          w      = +tooltip.style(\"width\").slice(0, -2),\n          left   = d3.event.pageX - w / 2,\n          adjust\n          ;\n\n          // Slide tooltips away from edges\n          if (matrix.e <= width * .25) {\n            adjust = (width - matrix.e) / width;\n            left += adjust * w / 2;\n          } else if (matrix.e >= width * .75) {\n            adjust = 1 - (width - matrix.e) / width;\n            left -= adjust * w / 2;\n          }\n\n          return left + \"px\";\n        });\n\n        tooltip.style(\"top\", function() {\n          var h   = +tooltip.style(\"height\").slice(0, -2);\n          var top = d3.event.pageY;\n          \n          top = (matrix.f >= height * .5) ? top - h * 1.5 : top + 15;\n          \n          return top + \"px\";\n        });\n      })\n      .on(\"mouseout\", function() {\n        d3.select(\"#barchart-tooltip\").classed(\"hidden\", true);\n      })\n  }\n\n  \n})();\n\n"],"sourceRoot":"/source/"}